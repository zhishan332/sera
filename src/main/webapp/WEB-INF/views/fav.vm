<div class="ui padded grid">
    <div class="purple row">
        <div class="column">
            <a class="ui inverted header" href="/index" style="font-size: 20px">云端收藏夹</a>
        </div>
    </div>
</div>
<div class="ui padded grid">
    <div class="row" style="padding-top: 8px;padding-bottom: 3px;">
        <div class="column">
            <div class="ui icon  input" style="margin-left: 5p;float: right">
                <input type="text" placeholder="搜索...">
                <i class="search icon"></i>
            </div>

            <div class="field" style="margin-left: 5p;float: right">
                <select class="ui dropdown" id="groupSelect">
                    <option value="-1">全部</option>
                    #if($!{groupData})
                        #foreach($group in  $groupData)
                            <option value="$!{group.groupId}">$!{group.groupName}</option>
                        #end
                    #end
                </select>
            </div>

            <div class="compact ui left floated purple icon button"><i class="plus icon"></i>新建分组</div>
            <div class="compact ui left floated blue icon button"><i class="sort content descending icon"></i>智能排序</div>
            <div class="compact ui left floated blue icon button"><i class="bug icon"></i>智能检测</div>
            <div class="compact ui left floated blue icon button"><i class="unlink icon"></i>删除失效</div>
            <div class="compact ui left floated green icon button"><i class="download icon"></i>收藏工具</div>
            <input type="file" name="_impFile" id="_impFile">
            <a style="float: left;margin-top: 6px;margin-left: 4px" href="">浏览他人</a>
        </div>
    </div>
</div>
<div class="ui grid" style="margin: 0 10px;width: 99%">
    #if($!{favData})
        #foreach($entry in  $favData.entrySet())
            #set ($key = $entry.key)
            #set ($favList = $entry.value)
            #set ($keyArray = $key.split("/"))
            #set ($title = $!{keyArray.get(0)})
            #if($title.length()>30)
                #set($showTitle=$title.substring(0,30))
            #else
                #set($showTitle=$title)
            #end

            <div class="$!{groupWith} wide column" style="padding: 10px">
                <input type="hidden" value="$!{keyArray.get(1)}" id="grid_$!{keyArray.get(1)}">
                <div class="ui raised segment">
                    <a class="ui teal ribbon label">$showTitle</a>
                    <div style="float: right">
                        <div class="compact ui purple   icon button right  floated"
                             onclick="addFav($!{keyArray.get(1)})"><i class="plus icon"></i>
                        </div>
                        <div class="compact ui purple   icon button right  floated"
                             onclick="protectFav($!{keyArray.get(1)})"><i class="lock icon"></i>
                        </div>
                        <div class="compact ui red   icon button right  floated"><i class="remove icon"></i></div>
                    </div>

                    <div class="ui mini divided list">
                        #foreach($fav in  $favList)
                            <div class="item" style="padding: 1px 0">
                                <div class="right floated" style="margin-top: 10px">
                                    <div class="compact ui green empty circular label" title="正常"></div>
                                    <div class="compact ui mini pink  icon  button"><i class="empty heart icon"></i></div>
                                    <div class="compact ui mini red  icon  button"><i class="minus icon"></i></div>
                                </div>
                                #if($!{fav.favIco})
                                    <img class="ui  avatar image" src="$!{fav.favIco}">
                                #else
                                    <img class="ui  avatar image"
                                         src="/statics/img/MetroUI_Internet_Explorer_64px_1121836.png">
                                #end
                                #set ($favTitle = $!{fav.favTitle})
                                #if($favTitle.length()>$!{titleLen})
                                    #set($showFavTitle=$favTitle.substring(0,$!{titleLen}))
                                #else
                                    #set($showFavTitle=$favTitle)
                                #end

                                #set ($favUrl = $!{fav.favUrl})
                                #if($favUrl.length()>$!{urlLen})
                                    #set($showFavUrl=$favUrl.substring(0,$!{urlLen}))
                                #else
                                    #set($showFavUrl=$favUrl)
                                #end
                                <div class="content">
                                    <a class="header fav">$!{showFavTitle}</a>
                                    <div class="description fav"><a target="_blank" href="$!{fav.favUrl}">$!{showFavUrl}</a>
                                    </div>
                                </div>
                            </div>
                        #end
                    </div>
                </div>
            </div>
        #end
    #end
</div>

<div class="ui modal" id="addFavModal">
    <i class="close icon"></i>
    <div class="header">
        添加收藏
    </div>
    <div class="content">
        <div class="ui form">
            <div class="field">
                <label>输入网址</label>
                <input type="hidden" id="addFavInputGroup">
                <input type="text" id="addFavInputUrl">
            </div>
        </div>
    </div>
    <div class="actions">
        <div class="ui positive right labeled icon button" id="addFavInputBtn">
            保存
            <i class="checkmark icon"></i>
        </div>
        <div class="ui black button">
            取消
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('.ui.accordion').accordion();

        $('#addFavInputBtn').click(function (e) {
            saveFav();
        })
        initImp();
        $('#_impFile-button').css('line-height', '15px');
        $('select.dropdown').dropdown();

        $('#groupSelect').change(function () {
            var val = $("#groupSelect").val();
            var text = $("#groupSelect").find("option:selected").text();
            window.location.href = "/fav?gid=" + val + "&gname=" + encodeURI(text);
        });
    })

    function initImp() {
        var uploadSwf = '#springUrl('statics/plugin/uploadify/uploadify.swf')';
        $("#_impFile").uploadify({
            formData: {
                'timestamp': '222',
                'token': '123',
                'type': '22'
            },
            queueID: '__not_exit_queue',//不存在的ID,删除该配置可显示进度条
            successTimeout: 120,//2分钟超时
            fileSizeLimit: '10MB',//B, KB, MB, or GB
            height: 30,
            swf: uploadSwf,
            uploader: $("#contextPath").val() + '/import/bookmark',
            fileObjName: 'file',
            buttonClass: 'compact ui green icon button right',
            buttonText: '从浏览器导入',
            onUploadStart: function (file) {
                $('#_impFile').uploadify('disable', true);
            },
            //上传到服务器，服务器返回相应信息到data里
            onUploadSuccess: function (file, data, response) {
                $('#_impFile').uploadify('disable', false);
                layer.msg('导入完成');
            },
            onUploadError: function (file, errorCode, errorMsg, errorString) {
                $('#_impFile').uploadify('disable', false);
            }

        });
    }
    function addFav(groupID) {
        $('#addFavInputGroup').val(groupID);
        $('#addFavModal').modal('setting', 'duration', 100).modal('show');
    }

    function saveFav() {

        var param = {};
        param.groupId = $('#addFavInputGroup').val();
        param.favUrl = $('#addFavInputUrl').val();
        var reqUrl = $("#contextPath").val() + "/fav/add";
        AjaxUtil.post(reqUrl, param, function (resp) {
            if (resp == undefined || resp == null) {
                layer.alert("系统异常", {icon: 5});
            } else {
                layer.msg('收藏成功');
            }
        });
    }

    function protectFav(groupID) {

    }
</script>
<script src="#springUrl('statics/plugin/uploadify/jquery.uploadify.js')" type="text/javascript"></script>

